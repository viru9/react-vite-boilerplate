services:
  # React Frontend Production with Nginx
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.prod
      args:
        VITE_API_BASE_URL: ${VITE_API_BASE_URL:-https://api.yourdomain.com/api/v1}
        VITE_WS_BASE_URL: ${VITE_WS_BASE_URL:-wss://api.yourdomain.com}
        VITE_APP_NAME: ${VITE_APP_NAME:-React Boilerplate}
        VITE_TOKEN_KEY: ${VITE_TOKEN_KEY:-auth_token}
        VITE_REFRESH_TOKEN_KEY: ${VITE_REFRESH_TOKEN_KEY:-refresh_token}
        VITE_API_TIMEOUT: ${VITE_API_TIMEOUT:-30000}
        VITE_ENVIRONMENT: ${VITE_ENVIRONMENT:-production}
    container_name: frontend_app_prod
    restart: unless-stopped
    ports:
      - '80:80'
      - '443:443'
    volumes:
      # SSL certificates (if using Let's Encrypt)
      - ./ssl:/etc/nginx/ssl:ro
      # Custom nginx configuration
      - ./deploy/docker/nginx.conf:/etc/nginx/nginx.conf:ro
      # Logs
      - ./logs/nginx:/var/log/nginx
    environment:
      - NGINX_HOST=${NGINX_HOST:-yourdomain.com}
      - NGINX_PORT=80
      - BACKEND_HOST=${BACKEND_HOST:-backend}
      - BACKEND_PORT=${BACKEND_PORT:-8000}
    networks:
      - frontend_network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  frontend_network:
    driver: bridge